{% extends "inventory/base.html" %}
{% load static %}

{% block title %}在庫管理{% endblock %}

{% block content %}
<h2 class="page-title">在庫管理</h2>

<div class="grid-3">

  <!-- 左：アイテム登録 -->
  <section class="card">
    <h3 class="card-title">アイテム登録</h3>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button class="btn btn-primary" type="submit">登録</button>
    </form>
  </section>

  <!-- 中：在庫一覧 -->
  <section class="card">
    <h3 class="card-title">在庫一覧</h3>

    <table class="table">
      <thead>
        <tr>
          <th>食品名</th>
          <th>賞味期限</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td>
            <div class="item-name">{{ item.name }}</div>
            <div class="item-actions">
              <a href="{% url 'inventory:item_edit' item.id %}">編集</a>
              <a href="{% url 'inventory:item_delete' item.id %}">削除</a>
            </div>
          </td>

          <td>
            {% if item.days_left < 0 %}
              <span class="expired">{{ item.expiration_date }} ⚠️期限切れ</span>

            {% elif item.days_left <= 1 %}
              <span class="urgent">{{ item.expiration_date }}（{{ item.days_left }}日前）</span>

            {% elif item.days_left == 2 %}
              <span class="warn">{{ item.expiration_date }}（{{ item.days_left }}日前）</span>

            {% elif item.days_left <= 5 %}
              <span class="safe">{{ item.expiration_date }}（{{ item.days_left }}日前）</span>

            {% else %}
              {{ item.expiration_date }}（{{ item.days_left }}日前）
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">登録されているアイテムはありません</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- 右：レシピ検索 -->
  <section class="card">
    <h3 class="card-title">レシピ検索</h3>

    <form id="recipe-search-form" data-endpoint="{% url 'inventory:recipe_search' %}">
      <div class="form-row">
        <input type="text" name="q" value="{{ keyword }}" placeholder="例：卵">
      </div>
      <button class="btn btn-primary" type="submit">検索</button>
    </form>

    <div id="recipe-results">
      {% include "inventory/_recipe_results.html" with recipes=recipes keyword=keyword %}
    </div>
  </section>

</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'inventory/app.js' %}"></script>
{% endblock %}