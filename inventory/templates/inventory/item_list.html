<h2>在庫管理</h2>

<div style="display: flex; gap: 20px;">

  <!-- 左：アイテム登録 -->
  <div style="width: 25%;">
    <h3>アイテム登録</h3>
    <form method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">登録</button>
    </form>
  </div>

  <!-- 中：在庫一覧 -->
  <div style="width: 40%;">
    <h3>在庫一覧</h3>

    <table style="width:100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="text-align:left;">食品名</th>
          <th style="text-align:left;">賞味期限</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <!-- 食品名 + 操作 -->
          <td style="vertical-align: top; padding-bottom: 10px;">
            <strong>{{ item.name }}</strong><br>
            <a href="{% url 'inventory:item_edit' item.id %}">編集</a> |
            <a href="{% url 'inventory:item_delete' item.id %}">削除</a>
          </td>

          <!-- 賞味期限 -->
          <td style="vertical-align: top;">
            {% if item.days_left is not None %}
              {% if item.days_left < 0 %}
                <span style="color: sienna; font-weight:bold;">
                  {{ item.expiration_date }} ⚠️期限切れ
                </span>
              {% elif item.days_left <= 1 %}
                <span style="color:red;">
                  {{ item.expiration_date }}（{{ item.days_left }}日前）
                </span>
              {% elif item.days_left == 2 %}
                <span style="color:orange;">
                  {{ item.expiration_date }}（{{ item.days_left }}日前）
                </span>
              {% elif 2 < item.days_left <= 5 %}
                <span style="color:green;">
                  {{ item.expiration_date }}（{{ item.days_left }}日前）
                </span>
              {% else %}
                {{ item.expiration_date }}
              {% endif %}
            {% else %}
              日付未登録
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="2">登録されているアイテムはありません</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- 右：レシピ検索 -->
  <div style="width: 35%; padding:10px; border-left:1px solid #ccc;">
    <h3>レシピ検索</h3>
    <form method="get">
      <input type="text" name="q" value="{{ keyword }}" placeholder="例：卵">
      <button type="submit">検索</button>
    </form>

    <ul>
      {% for recipe in recipes %}
        <li>
          <a href="{{ recipe.url }}" target="_blank">{{ recipe.title }}</a><br>
          {% if recipe.image %}
            <img src="{{ recipe.image }}" width="100">
          {% endif %}
        </li>
      {% empty %}
        {% if keyword %}
          <li>該当するレシピはありません</li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>

</div>
